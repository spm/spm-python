<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>spm.spm_uw_apply API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>spm.spm_uw_apply</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="spm.spm_uw_apply.spm_uw_apply"><code class="name flex">
<span>def <span class="ident">spm_uw_apply</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def spm_uw_apply(*args, **kwargs):
    &#34;&#34;&#34;
      Reslice images volume by volume  
        FORMAT spm_uw_apply(ds,[flags])  
        or  
        FORMAT P = spm_uw_apply(ds,[flags])  
         
         
        ds       - a structure created by spm_uw_estimate.m containing the fields:  
                   ds can also be an array of structures, each struct corresponding  
                   to one session (it hardly makes sense to try and pool fields across  
                   sessions since there will have been a reshimming). In that case each  
                   session is unwarped separately, unwarped into the distortion space of  
                   the average (default) position of that series, and with the first  
                   scan on the series defining the pahse encode direction. After that each  
                   scan is transformed into the space of the first scan of the first series.  
                   Naturally, there is still only one actual resampling (interpolation).  
                   It will be assumed that the same unwarping parameters have been used  
                   for all sessions (anything else would be truly daft).  
         
        .P           - Images used when estimating deformation field and/or  
                       its derivative w.r.t. modelled factors. Note that this  
                       struct-array may contain .mat fields that differ from  
                       those you would observe with spm_vol(P(1).fname). This  
                       is because spm_uw_estimate has an option to re-estimate  
                       the movement parameters. The re-estimated parameters are  
                       not written to disc (in the form of .mat files), but rather  
                       stored in the P array in the ds struct.  
         
        .order       - Number of basis functions to use for each dimension.  
                       If the third dimension is left out, the order for  
                       that dimension is calculated to yield a roughly  
                       equal spatial cut-off in all directions.  
                       Default: [8 8 *]  
        .sfP         - Static field supplied by the user. It should be a  
                       filename or handle to a voxel-displacement map in  
                       the same space as the first EPI image of the time-  
                       series. If using the FieldMap toolbox, realignment  
                       should (if necessary) have been performed as part of  
                       the process of creating the VDM. Note also that the  
                       VDM mut be in undistorted space, i.e. if it is  
                       calculated from an EPI based field-map sequence  
                       it should have been inverted before passing it to  
                       spm_uw_estimate. Again, the FieldMap toolbox will  
                       do this for you.  
        .regorder    - Regularisation of derivative fields is based on the  
                       regorder&#39;th (spatial) derivative of the field.  
                       Default: 1  
        .lambda      - Fudge factor used to decide relative weights of  
                       data and regularisation.  
                       Default: 1e5  
        .fot         - List of indexes for first order terms to model  
                       derivatives for. Order of parameters as defined  
                       by spm_imatrix.  
                       Default: [4 5]  
        .sot         - List of second order terms to model second  
                       derivatives of. Should be an nx2 matrix where  
                       e.g. [4 4; 4 5; 5 5] means that second partial  
                       derivatives of rotation around x- and y-axis  
                       should be modelled.  
                       Default: []  
        .fwhm        - FWHM (mm) of smoothing filter applied to images prior  
                       to estimation of deformation fields.  
                       Default: 6  
        .rem         - Re-Estimation of Movement parameters. Set to unity means  
                       that movement-parameters should be re-estimated at each  
                       iteration.  
                       Default: 0  
        .noi         - Maximum number of Iterations.  
                       Default: 5  
        .exp_round   - Point in position space to do Taylor expansion around.  
                       &#39;First&#39;, &#39;Last&#39; or &#39;Average&#39;.  
        .p0          - Average position vector (three translations in mm  
                       and three rotations in degrees) of scans in P.  
        .q           - Deviations from mean position vector of modelled  
                       effects. Corresponds to deviations (and deviations  
                       squared) of a Taylor expansion of deformation fields.  
        .beta        - Coeffeicents of DCT basis functions for partial  
                       derivatives of deformation fields w.r.t. modelled  
                       effects. Scaled such that resulting deformation  
                       fields have units mm^-1 or deg^-1 (and squares  
                       thereof).  
        .SS          - Sum of squared errors for each iteration.  
         
        flags    - a structure containing various options.  The fields are:  
         
                jm   - Jacobian Modulation. If set, intensity (Jacobian)  
                       deformations are included in the model. If zero,  
                       intensity deformations are not considered.  
                      0   - Do only unwarping (not correcting  
                            for changing sampling density).  
                      1   - Do both unwarping and Jacobian correction.  
         
                mask - mask output images (1 for yes, 0 for no)  
                       To avoid artifactual movement-related variance the realigned  
                       set of images can be internally masked, within the set (i.e.  
                       if any image has a zero value at a voxel than all images have  
                       zero values at that voxel).  Zero values occur when regions  
                       &#39;outside&#39; the image are moved &#39;inside&#39; the image during  
                       realignment.  
         
                mean - write mean image  
                       The average of all the realigned scans is written to  
                       mean*.&lt;ext&gt;.  
         
                interp - the interpolation method (see e.g. spm_bsplins.m).  
         
                which - Values of 0 or 1 are allowed.  
                        0   - don&#39;t create any resliced images.  
                              Useful if you only want a mean resliced image.  
                        1   - reslice all the images.  
         
                prefix - Filename prefix for resliced image files. Defaults to &#39;u&#39;.  
         
                    The spatially realigned images are written to the original  
                    subdirectory with the same filename but prefixed with an &#39;u&#39;.  
                    They are all aligned with the first.  
       __________________________________________________________________________  
      

    [Matlab code]( https://github.com/spm/spm/blob/main/spm_uw_apply.m )

    Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL
    &#34;&#34;&#34;
    return Runtime.call(&#34;spm_uw_apply&#34;, *args, **kwargs)</code></pre>
</details>
<div class="desc"><p>Reslice images volume by volume<br>
FORMAT spm_uw_apply(ds,[flags])<br>
or<br>
FORMAT P = spm_uw_apply(ds,[flags])
</p>
<pre><code>ds       - a structure created by spm_uw_estimate.m containing the fields:  
           ds can also be an array of structures, each struct corresponding  
           to one session (it hardly makes sense to try and pool fields across  
           sessions since there will have been a reshimming). In that case each  
           session is unwarped separately, unwarped into the distortion space of  
           the average (default) position of that series, and with the first  
           scan on the series defining the pahse encode direction. After that each  
           scan is transformed into the space of the first scan of the first series.  
           Naturally, there is still only one actual resampling (interpolation).  
           It will be assumed that the same unwarping parameters have been used  
           for all sessions (anything else would be truly daft).

.P           - Images used when estimating deformation field and/or  
               its derivative w.r.t. modelled factors. Note that this  
               struct-array may contain .mat fields that differ from  
               those you would observe with spm_vol(P(1).fname). This  
               is because spm_uw_estimate has an option to re-estimate  
               the movement parameters. The re-estimated parameters are  
               not written to disc (in the form of .mat files), but rather  
               stored in the P array in the ds struct.

.order       - Number of basis functions to use for each dimension.  
               If the third dimension is left out, the order for  
               that dimension is calculated to yield a roughly  
               equal spatial cut-off in all directions.  
               Default: [8 8 *]  
.sfP         - Static field supplied by the user. It should be a  
               filename or handle to a voxel-displacement map in  
               the same space as the first EPI image of the time-  
               series. If using the FieldMap toolbox, realignment  
               should (if necessary) have been performed as part of  
               the process of creating the VDM. Note also that the  
               VDM mut be in undistorted space, i.e. if it is  
               calculated from an EPI based field-map sequence  
               it should have been inverted before passing it to  
               spm_uw_estimate. Again, the FieldMap toolbox will  
               do this for you.  
.regorder    - Regularisation of derivative fields is based on the  
               regorder'th (spatial) derivative of the field.  
               Default: 1  
.lambda      - Fudge factor used to decide relative weights of  
               data and regularisation.  
               Default: 1e5  
.fot         - List of indexes for first order terms to model  
               derivatives for. Order of parameters as defined  
               by spm_imatrix.  
               Default: [4 5]  
.sot         - List of second order terms to model second  
               derivatives of. Should be an nx2 matrix where  
               e.g. [4 4; 4 5; 5 5] means that second partial  
               derivatives of rotation around x- and y-axis  
               should be modelled.  
               Default: []  
.fwhm        - FWHM (mm) of smoothing filter applied to images prior  
               to estimation of deformation fields.  
               Default: 6  
.rem         - Re-Estimation of Movement parameters. Set to unity means  
               that movement-parameters should be re-estimated at each  
               iteration.  
               Default: 0  
.noi         - Maximum number of Iterations.  
               Default: 5  
.exp_round   - Point in position space to do Taylor expansion around.  
               'First', 'Last' or 'Average'.  
.p0          - Average position vector (three translations in mm  
               and three rotations in degrees) of scans in P.  
.q           - Deviations from mean position vector of modelled  
               effects. Corresponds to deviations (and deviations  
               squared) of a Taylor expansion of deformation fields.  
.beta        - Coeffeicents of DCT basis functions for partial  
               derivatives of deformation fields w.r.t. modelled  
               effects. Scaled such that resulting deformation  
               fields have units mm^-1 or deg^-1 (and squares  
               thereof).  
.SS          - Sum of squared errors for each iteration.

flags    - a structure containing various options.  The fields are:

        jm   - Jacobian Modulation. If set, intensity (Jacobian)  
               deformations are included in the model. If zero,  
               intensity deformations are not considered.  
              0   - Do only unwarping (not correcting  
                    for changing sampling density).  
              1   - Do both unwarping and Jacobian correction.

        mask - mask output images (1 for yes, 0 for no)  
               To avoid artifactual movement-related variance the realigned  
               set of images can be internally masked, within the set (i.e.  
               if any image has a zero value at a voxel than all images have  
               zero values at that voxel).  Zero values occur when regions  
               'outside' the image are moved 'inside' the image during  
               realignment.

        mean - write mean image  
               The average of all the realigned scans is written to  
               mean*.&lt;ext&gt;.

        interp - the interpolation method (see e.g. spm_bsplins.m).

        which - Values of 0 or 1 are allowed.  
                0   - don't create any resliced images.  
                      Useful if you only want a mean resliced image.  
                1   - reslice all the images.

        prefix - Filename prefix for resliced image files. Defaults to 'u'.

            The spatially realigned images are written to the original  
            subdirectory with the same filename but prefixed with an 'u'.  
            They are all aligned with the first.
</code></pre>
<hr>
<p><a href="https://github.com/spm/spm/blob/main/spm_uw_apply.m">Matlab code</a></p>
<p>Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="spm" href="index.html">spm</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="spm.spm_uw_apply.spm_uw_apply" href="#spm.spm_uw_apply.spm_uw_apply">spm_uw_apply</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
