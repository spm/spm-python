<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>spm.spm_imcalc API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>spm.spm_imcalc</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="spm.spm_imcalc.spm_imcalc"><code class="name flex">
<span>def <span class="ident">spm_imcalc</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def spm_imcalc(*args, **kwargs):
    &#34;&#34;&#34;
      Perform algebraic functions on images  
        FORMAT Vo = spm_imcalc(Vi, Vo, f [,flags [,extra_vars...]])  
        Vi            - struct array (from spm_vol) of images to work on  
                        or a char array of input image filenames  
        Vo (input)    - struct array (from spm_vol) containing information on  
                        output image  
                        ( pinfo field is computed for the resultant image data, )  
                        ( and can be omitted from Vo on input.  See spm_vol     )  
                        or output image filename  
        f             - MATLAB expression to be evaluated  
        flags         - cell array of flags: {dmtx,mask,interp,dtype,descrip}  
                        or structure with these fieldnames  
             dmtx     - read images into data matrix?  
                        [defaults (missing or empty) to 0 - no]  
             mask     - implicit zero mask?  
                        [defaults (missing or empty) to 0 - no]  
                         ( negative value implies NaNs should be zeroed )  
             interp   - interpolation hold (see spm_slice_vol)  
                        [defaults (missing or empty) to 0 - nearest neighbour]  
             dtype    - data type for output image (see spm_type)  
                        [defaults (missing or empty) to 4 - 16 bit signed shorts]  
             descrip  - content of the &#39;descrip&#39; field of the NIfTI header  
                        [defaults (missing or empty) to &#39;spm - algebra&#39;]  
        extra_vars... - additional variables which can be used in expression  
         
        Vo (output)   - spm_vol structure of output image volume after  
                        modifications for writing  
       __________________________________________________________________________  
         
        spm_imcalc performs user-specified algebraic manipulations on a set of  
        images, with the result being written out as an image.   
        The images specified in Vi, are referred to as i1, i2, i3,...  in the  
        expression to be evaluated, unless the dmtx flag is setm in which  
        case the images are read into a data matrix X, with images in rows.  
         
        Computation is plane by plane, so in data-matrix mode, X is a NxK  
        matrix, where N is the number of input images [prod(size(Vi))], and K  
        is the number of voxels per plane [prod(Vi(1).dim(1:2))].  
         
        For data types without a representation of NaN, implicit zero masking  
        assumes that all zero voxels are to be treated as missing, and treats  
        them as NaN. NaN&#39;s are written as zero, for data types without a  
        representation of NaN.  
         
        With images of different sizes and orientations, the size and orientation  
        of the reference image is used. Reference is the first image, if  
        Vo (input) is a filename, otherwise reference is Vo (input). A  
        warning is given in this situation. Images are sampled into this  
        orientation using the interpolation specified by the interp parameter.  
       __________________________________________________________________________  
         
        Example expressions (f):  
         
           i)  Mean of six images (select six images)  
               f = &#39;(i1+i2+i3+i4+i5+i6)/6&#39;  
          ii)  Make a binary mask image at threshold of 100  
               f = &#39;i1&gt;100&#39;  
          iii) Make a mask from one image and apply to another  
               f = &#39;(i1&gt;100).*i2&#39;  
               (here the first image is used to make the mask, which is applied  
                to the second image - note the &#39;.*&#39; operator)  
          iv)  Sum of n images  
               f = &#39;i1 + i2 + i3 + i4 + i5 + ...&#39;  
          v)   Sum of n images (when reading data into data-matrix)  
               f = &#39;sum(X)&#39;  
          vi)  Mean of n images (when reading data into data-matrix)  
               f = &#39;mean(X)&#39;  
       __________________________________________________________________________  
         
        Furthermore, additional variables for use in the computation can be  
        passed at the end of the argument list. These should be referred to by  
        the names of the arguments passed in the expression to be evaluated.   
        E.g. if c is a 1xn vector of weights, then for n images, using the (dmtx)  
        data-matrix version, the weighted sum can be computed using:  
              Vi = spm_vol(spm_select(inf,&#39;image&#39;));  
              Vo = &#39;output.nii&#39;  
              Q  = spm_imcalc(Vi,Vo,&#39;c*X&#39;,{1},c)  
        Here we&#39;ve pre-specified the expression and passed the vector c as an  
        additional variable (you&#39;ll be prompted to select the n images).  
       __________________________________________________________________________  
      

    [Matlab code]( https://github.com/spm/spm/blob/main/spm_imcalc.m )

    Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL
    &#34;&#34;&#34;
    return Runtime.call(&#34;spm_imcalc&#34;, *args, **kwargs)</code></pre>
</details>
<div class="desc"><p>Perform algebraic functions on images<br>
FORMAT Vo = spm_imcalc(Vi, Vo, f [,flags [,extra_vars&hellip;]])<br>
Vi
- struct array (from spm_vol) of images to work on<br>
or a char array of input image filenames<br>
Vo (input)
- struct array (from spm_vol) containing information on<br>
output image<br>
( pinfo field is computed for the resultant image data, )<br>
( and can be omitted from Vo on input.
See spm_vol
)<br>
or output image filename<br>
f
- MATLAB expression to be evaluated<br>
flags
- cell array of flags: {dmtx,mask,interp,dtype,descrip}<br>
or structure with these fieldnames<br>
dmtx
- read images into data matrix?<br>
[defaults (missing or empty) to 0 - no]<br>
mask
- implicit zero mask?<br>
[defaults (missing or empty) to 0 - no]<br>
( negative value implies NaNs should be zeroed )<br>
interp
- interpolation hold (see spm_slice_vol)<br>
[defaults (missing or empty) to 0 - nearest neighbour]<br>
dtype
- data type for output image (see spm_type)<br>
[defaults (missing or empty) to 4 - 16 bit signed shorts]<br>
descrip
- content of the 'descrip' field of the NIfTI header<br>
[defaults (missing or empty) to 'spm - algebra']<br>
extra_vars&hellip; - additional variables which can be used in expression
</p>
<pre><code>Vo (output)   - spm_vol structure of output image volume after  
                modifications for writing
</code></pre>
<hr>
<pre><code>spm_imcalc performs user-specified algebraic manipulations on a set of  
images, with the result being written out as an image.   
The images specified in Vi, are referred to as i1, i2, i3,...  in the  
expression to be evaluated, unless the dmtx flag is setm in which  
case the images are read into a data matrix X, with images in rows.

Computation is plane by plane, so in data-matrix mode, X is a NxK  
matrix, where N is the number of input images [prod(size(Vi))], and K  
is the number of voxels per plane [prod(Vi(1).dim(1:2))].

For data types without a representation of NaN, implicit zero masking  
assumes that all zero voxels are to be treated as missing, and treats  
them as NaN. NaN's are written as zero, for data types without a  
representation of NaN.

With images of different sizes and orientations, the size and orientation  
of the reference image is used. Reference is the first image, if  
Vo (input) is a filename, otherwise reference is Vo (input). A  
warning is given in this situation. Images are sampled into this  
orientation using the interpolation specified by the interp parameter.
</code></pre>
<hr>
<pre><code>Example expressions (f):

   i)  Mean of six images (select six images)  
       f = '(i1+i2+i3+i4+i5+i6)/6'  
  ii)  Make a binary mask image at threshold of 100  
       f = 'i1&gt;100'  
  iii) Make a mask from one image and apply to another  
       f = '(i1&gt;100).*i2'  
       (here the first image is used to make the mask, which is applied  
        to the second image - note the '.*' operator)  
  iv)  Sum of n images  
       f = 'i1 + i2 + i3 + i4 + i5 + ...'  
  v)   Sum of n images (when reading data into data-matrix)  
       f = 'sum(X)'  
  vi)  Mean of n images (when reading data into data-matrix)  
       f = 'mean(X)'
</code></pre>
<hr>
<pre><code>Furthermore, additional variables for use in the computation can be  
passed at the end of the argument list. These should be referred to by  
the names of the arguments passed in the expression to be evaluated.   
E.g. if c is a 1xn vector of weights, then for n images, using the (dmtx)  
data-matrix version, the weighted sum can be computed using:  
      Vi = spm_vol(spm_select(inf,'image'));  
      Vo = 'output.nii'  
      Q  = spm_imcalc(Vi,Vo,'c*X',{1},c)  
Here we've pre-specified the expression and passed the vector c as an  
additional variable (you'll be prompted to select the n images).
</code></pre>
<hr>
<p><a href="https://github.com/spm/spm/blob/main/spm_imcalc.m">Matlab code</a></p>
<p>Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="spm" href="index.html">spm</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="spm.spm_imcalc.spm_imcalc" href="#spm.spm_imcalc.spm_imcalc">spm_imcalc</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
