<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>spm.spm_dcm_J API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>spm.spm_dcm_J</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="spm.spm_dcm_J.spm_dcm_J"><code class="name flex">
<span>def <span class="ident">spm_dcm_J</span></span>(<span>*args, **kwargs)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def spm_dcm_J(*args, **kwargs):
    &#34;&#34;&#34;
      VOI extraction of adjusted data and Markov Blanket decomposition  
        FORMAT [J,K] = spm_dcm_J(Y,U,X0,dt,R,I,D)  
         
        Y  - response variable  
        U  - exogenous inputs  
        XO - confounds  
        dt - time bin  
        R  - distance matrix  
        I  - self inhibition [default: -1]  
        D  - upper bound on distance (mm) [default: 64]  
         
        J(nv,nv)  - Jacobian  
        K(nv,nu)  - input block  
         
       __________________________________________________________________________  
        This routine evaluates the effective connectivity of a dynamic causal  
        model based upon the Jacobian (i.e., state matrix) of a stochastic  
        differential equation. In other words, it approximates the coupling among  
        hidden states to first order, under some simplifying assumptions.  
        Starting from a linear state space model, in which the response variable  
        (y) is a linear convolution (K) of some hidden states (x) subject to  
        observation and system noise (r and e) respectively, we have:  
         
        D*x = x*J&#39; + e  =&gt; K*D*x = K*x*J&#39; + K*e = D*y = y*J&#39; + K*e + D*r - r*J&#39;  
        y   = K*x  + r  =&gt;   D*y = K*D*x  + D*r  
         
        This means we can approximate the system with a general linear model:  
         
        D*y = y*J&#39; + w:   cov(w) = h(1)*K*K&#39; + h(2)*D*D&#39; + h(3)*I  
         
        Where, h(3)*I  = h(2)*J*J&#39;, approximately; noting that the leading  
        diagonal of J will dominate (and be negative). If K is specified in terms  
        of convolution kernels, then the covariance components of the linearised  
        system can be expressed as:  
         
        K = k(1)*K{1} + k(2)*K{2} + ...  
          =&gt; K*K&#39; = k(1)*k(1)*K{1}*K{1}&#39; + k(1)*k(2)*K{1}*K{2}&#39; ...  
         
        Where k(i)*k(j) replaces the [hyper]parameter h(1) above. This linearized  
        system can be solved using parametric empirical Bayes (PEB) for each  
        response variable, under the simplifying assumption that there are the  
        same number of observations and hidden states.  
         
        This allows large graphs to be inverted by considering the afferents  
        (i.e., influences on) to each node sequentially. Redundant elements of  
        the Jacobian (i.e., connections) are subsequently removed using Bayesian  
        model reduction (BMR). The result is a sparse Jacobian that corresponds  
        to the coupling among hidden states that generate observed double  
        responses, to first-order.  
         
        See: Frassle S, Lomakina EI, Kasper L, Manjaly ZM, Leff A, Pruessmann KP,  
        Buhmann JM, Stephan KE. A generative model of whole-brain effective  
        connectivity.Neuroimage. 2018 Oct 1;179:505-529.  
         
        GRAPHICAL OUTPUT Sparse connectivity: the figure illustrates the sparsity  
        of effective connectivity using Bayesian model reduction. The left panel  
        shows the log evidence for a series of models that preclude connections  
        beyond a certain distance or radius. This log evidence is been normalised  
        to the log evidence of the model with the least marginal likelihood. The  
        middle panel shows the ensuing sparse coupling (within the upper bound of  
        D mm) as an adjacency matrix, where particles have been ordered using a  
        nearest neighbour scheme in voxel space. The blue dots indicate  
        connections that have been removed by Bayesian model reduction. The right  
        panel zooms in on the first 32 particles, to show local connections that  
        were retained (red) or removed (blue).  
       __________________________________________________________________________  
      

    [Matlab code]( https://github.com/spm/spm/blob/main/spm_dcm_J.m )

    Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL
    &#34;&#34;&#34;
    return Runtime.call(&#34;spm_dcm_J&#34;, *args, **kwargs)</code></pre>
</details>
<div class="desc"><p>VOI extraction of adjusted data and Markov Blanket decomposition<br>
FORMAT [J,K] = spm_dcm_J(Y,U,X0,dt,R,I,D)
</p>
<pre><code>Y  - response variable  
U  - exogenous inputs  
XO - confounds  
dt - time bin  
R  - distance matrix  
I  - self inhibition [default: -1]  
D  - upper bound on distance (mm) [default: 64]

J(nv,nv)  - Jacobian  
K(nv,nu)  - input block
</code></pre>
<hr>
<pre><code>This routine evaluates the effective connectivity of a dynamic causal  
model based upon the Jacobian (i.e., state matrix) of a stochastic  
differential equation. In other words, it approximates the coupling among  
hidden states to first order, under some simplifying assumptions.  
Starting from a linear state space model, in which the response variable  
(y) is a linear convolution (K) of some hidden states (x) subject to  
observation and system noise (r and e) respectively, we have:

D*x = x*J' + e  =&gt; K*D*x = K*x*J' + K*e = D*y = y*J' + K*e + D*r - r*J'  
y   = K*x  + r  =&gt;   D*y = K*D*x  + D*r

This means we can approximate the system with a general linear model:

D*y = y*J' + w:   cov(w) = h(1)*K*K' + h(2)*D*D' + h(3)*I

Where, h(3)*I  = h(2)*J*J', approximately; noting that the leading  
diagonal of J will dominate (and be negative). If K is specified in terms  
of convolution kernels, then the covariance components of the linearised  
system can be expressed as:

K = k(1)*K{1} + k(2)*K{2} + ...  
  =&gt; K*K' = k(1)*k(1)*K{1}*K{1}' + k(1)*k(2)*K{1}*K{2}' ...

Where k(i)*k(j) replaces the [hyper]parameter h(1) above. This linearized  
system can be solved using parametric empirical Bayes (PEB) for each  
response variable, under the simplifying assumption that there are the  
same number of observations and hidden states.

This allows large graphs to be inverted by considering the afferents  
(i.e., influences on) to each node sequentially. Redundant elements of  
the Jacobian (i.e., connections) are subsequently removed using Bayesian  
model reduction (BMR). The result is a sparse Jacobian that corresponds  
to the coupling among hidden states that generate observed double  
responses, to first-order.

See: Frassle S, Lomakina EI, Kasper L, Manjaly ZM, Leff A, Pruessmann KP,  
Buhmann JM, Stephan KE. A generative model of whole-brain effective  
connectivity.Neuroimage. 2018 Oct 1;179:505-529.

GRAPHICAL OUTPUT Sparse connectivity: the figure illustrates the sparsity  
of effective connectivity using Bayesian model reduction. The left panel  
shows the log evidence for a series of models that preclude connections  
beyond a certain distance or radius. This log evidence is been normalised  
to the log evidence of the model with the least marginal likelihood. The  
middle panel shows the ensuing sparse coupling (within the upper bound of  
D mm) as an adjacency matrix, where particles have been ordered using a  
nearest neighbour scheme in voxel space. The blue dots indicate  
connections that have been removed by Bayesian model reduction. The right  
panel zooms in on the first 32 particles, to show local connections that  
were retained (red) or removed (blue).
</code></pre>
<hr>
<p><a href="https://github.com/spm/spm/blob/main/spm_dcm_J.m">Matlab code</a></p>
<p>Copyright (C) 1995-2025 Functional Imaging Laboratory, Department of Imaging Neuroscience, UCL</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="spm" href="index.html">spm</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="spm.spm_dcm_J.spm_dcm_J" href="#spm.spm_dcm_J.spm_dcm_J">spm_dcm_J</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
