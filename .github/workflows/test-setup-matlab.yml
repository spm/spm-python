name: Test Setup Matlab 

on:
  workflow_dispatch:

jobs:
  setup-matlab:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: False
      matrix:
        os: [ubuntu-latest, macos-13, macos-latest, windows-latest]
        python-version: ["3.9", "3.10", "3.11", "3.12"]
        include:
          - os: ubuntu-latest
            os_name: Linux
            platform: Linux
          - os: macos-13
            os_name: macOS_Intel
            platform: Mac
          - os: macos-latest
            os_name: macOS_Apple_Silicon
            platform: Mac
          - os: windows-latest
            os_name: Windows
            platform: Windows
    steps:
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          
      - name: Check out SPM Python
        uses: actions/checkout@v4

      - name: Install SPM Python
        run: python -m pip install -e .

      - name: Try to setup Matlab
        shell: bash
        run: |
          cd scripts
          python -m setup_matlab -d
      
      - name: Run tests (Mac Intel)
        if: matrix.platform == 'Mac' 
        run: mwpython -m unittest discover tests -v

      - name: Run tests (Linux)
        if: matrix.os_name != 'Mac' 
        run: python -m unittest discover tests -v
